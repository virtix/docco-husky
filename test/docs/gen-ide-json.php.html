<!DOCTYPE html><html><head><title>gen-ide-json.php</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="./docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="./index.html" class="source"><span class="file_name">README</span></a><a href="././agents.clj.html" class="source "><span class="base_path">. / </span><span class="file_name">agents.clj</span></a><a href="././arma.R.html" class="source "><span class="base_path">. / </span><span class="file_name">arma.R</span></a><a href="././crypto_null.c.html" class="source "><span class="base_path">. / </span><span class="file_name">crypto_null.c</span></a><a href="././Foo.java.html" class="source "><span class="base_path">. / </span><span class="file_name">Foo.java</span></a><a href="././gen-ide-json.php.html" class="source selected"><span class="base_path">. / </span><span class="file_name">gen-ide-json.php</span></a><a href="././hello.bf.html" class="source "><span class="base_path">. / </span><span class="file_name">hello.bf</span></a><a href="././phantomjs.pp.html" class="source "><span class="base_path">. / </span><span class="file_name">phantomjs.pp</span></a><a href="././test.js.html" class="source "><span class="base_path">. / </span><span class="file_name">test.js</span></a><a href="././views.py.html" class="source "><span class="base_path">. / </span><span class="file_name">views.py</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>gen-ide-json.php</h1><div class="filepath">./</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div>
</td><td class="code"><div class="highlight"><pre><span class="x">#!/usr/bin/env php</span>
<span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">phpdotnet\phd</span> <span class="k">as</span> <span class="nx">PhD</span><span class="p">;</span>

<span class="nv">$lang</span> <span class="o">=</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$lang</span><span class="p">))</span> <span class="p">{</span> 
  <span class="nv">$lang</span> <span class="o">=</span> <span class="s1">&#39;en&#39;</span><span class="p">;</span> 
<span class="p">}</span></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><p>@todo document these settings and requirements</p>
</td><td class="code"><div class="highlight"><pre><span class="nb">define</span> <span class="p">(</span><span class="s1">&#39;FILENAME_JSON&#39;</span><span class="p">,</span>  <span class="s1">&#39;/local/Web/sites/doc.php.net/www/downloads/json/php_manual_&#39;</span> <span class="o">.</span> <span class="nv">$lang</span> <span class="o">.</span> <span class="s1">&#39;.json&#39;</span><span class="p">);</span>
<span class="nb">define</span> <span class="p">(</span><span class="s1">&#39;PHD_INSTALL_DIR&#39;</span><span class="p">,</span>  <span class="s1">&#39;/local/src/phd/&#39;</span><span class="p">);</span>
<span class="nb">define</span> <span class="p">(</span><span class="s1">&#39;PHD_OUTPUT_DIR&#39;</span><span class="p">,</span> <span class="s1">&#39;/local/building/&#39;</span> <span class="o">.</span> <span class="nv">$lang</span> <span class="o">.</span> <span class="s1">&#39;/&#39;</span><span class="p">);</span>
<span class="nb">define</span> <span class="p">(</span><span class="s1">&#39;DS&#39;</span><span class="p">,</span>       <span class="nx">DIRECTORY_SEPARATOR</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">is_dir</span><span class="p">(</span><span class="nx">PHD_INSTALL_DIR</span><span class="p">))</span> <span class="p">{</span>
  <span class="k">echo</span> <span class="s1">&#39;Fatal error: PHD_INSTALL_DIR is not a directory. It must contain PhD (look for a phpdotnet/ subdirectory).&#39;</span> <span class="o">.</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
  <span class="k">exit</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">is_dir</span><span class="p">(</span><span class="nx">PHD_OUTPUT_DIR</span><span class="p">))</span> <span class="p">{</span>
  <span class="k">echo</span> <span class="s1">&#39;Fatal error: PHD_OUTPUT_DIR is not a directory. It must contain output generated by PhD.&#39;</span> <span class="o">.</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
  <span class="k">echo</span> <span class="s1">&#39;Information: $ phd --docbook /foo/.manual.xml --package IDE --format xml&#39;</span> <span class="o">.</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
  <span class="k">echo</span> <span class="s1">&#39;Information: $ phd --docbook /foo/.manual.xml --package IDE --format funclist&#39;</span> <span class="o">.</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
  <span class="k">exit</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">require</span> <span class="nx">PHD_INSTALL_DIR</span> <span class="o">.</span> <span class="nx">DS</span> <span class="o">.</span> <span class="s1">&#39;phpdotnet&#39;</span> <span class="o">.</span> <span class="nx">DS</span> <span class="o">.</span> <span class="s1">&#39;phd&#39;</span> <span class="o">.</span> <span class="nx">DS</span> <span class="o">.</span> <span class="s1">&#39;Autoloader.php&#39;</span><span class="p">;</span>
<span class="k">require</span> <span class="nx">PHD_INSTALL_DIR</span> <span class="o">.</span> <span class="nx">DS</span> <span class="o">.</span> <span class="s1">&#39;phpdotnet&#39;</span> <span class="o">.</span> <span class="nx">DS</span> <span class="o">.</span> <span class="s1">&#39;phd&#39;</span> <span class="o">.</span> <span class="nx">DS</span> <span class="o">.</span> <span class="s1">&#39;functions.php&#39;</span><span class="p">;</span>

<span class="nb">spl_autoload_register</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;phpdotnet\phd\Autoloader&#39;</span><span class="p">,</span> <span class="s1">&#39;autoload&#39;</span><span class="p">));</span></pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><p>@todo this may not be needed in the future</p>
</td><td class="code"><div class="highlight"><pre><span class="nx">PhD\Config</span><span class="o">::</span><span class="na">init</span><span class="p">(</span><span class="k">array</span><span class="p">());</span>

<span class="nv">$api</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PhD\Package_IDE_API</span><span class="p">(</span><span class="nx">PHD_OUTPUT_DIR</span><span class="p">);</span></pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><p>Gets all documented functions/methods</p>
</td><td class="code"><div class="highlight"><pre><span class="nv">$functions</span> <span class="o">=</span> <span class="nv">$api</span><span class="o">-&gt;</span><span class="na">getFunctionList</span><span class="p">();</span>


<span class="nv">$json_arr</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$functions</span> <span class="k">as</span> <span class="nv">$function_name</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><p>@todo fix source so trim() isn't needed</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">$function_name</span> <span class="o">=</span> <span class="nx">trim</span><span class="p">(</span><span class="nv">$function_name</span><span class="p">);</span>
  
  <span class="nv">$function</span>      <span class="o">=</span> <span class="nv">$api</span><span class="o">-&gt;</span><span class="na">getFunctionByName</span><span class="p">(</span><span class="nv">$function_name</span><span class="p">);</span>
  <span class="nv">$prototype</span>     <span class="o">=</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$function</span><span class="p">;</span>
  </pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><p>@todo fix this. Replaces class.method with class::method
@todo fix this? Replaces NULL with null, to remain consistent</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">$function_name_fixed</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;::&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$function_name</span><span class="p">);</span>
  <span class="nv">$prototype</span>           <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="nv">$function_name</span><span class="p">,</span> <span class="nv">$function_name_fixed</span><span class="p">,</span> <span class="nv">$prototype</span><span class="p">);</span>
  <span class="nv">$prototype</span>           <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s1">&#39;NULL&#39;</span><span class="p">,</span> <span class="s1">&#39;null&#39;</span><span class="p">,</span> <span class="nv">$prototype</span><span class="p">);</span>
  </pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><p>Some contain new lines, let's remove them</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">$purpose</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$function</span><span class="o">-&gt;</span><span class="na">getPurpose</span><span class="p">());</span></pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><p>@todo fix bug when return description contains tables (example: variant_and())</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">$return</span>  <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$function</span><span class="o">-&gt;</span><span class="na">getReturnDescription</span><span class="p">());</span></pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><p>Some 'function names' contain spaces, like 'Constants for PDO_4D'
@todo fix this bug in the source</p>
</td><td class="code"><div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="k">false</span> <span class="o">!==</span> <span class="nb">strpos</span><span class="p">(</span><span class="nv">$function_name_fixed</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">continue</span><span class="p">;</span>
  <span class="p">}</span></pre></div></td></tr><tr id="section-10"><td class="docs"><div class="pilwrap"><a href="#section-10" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Define our array structure for json. Example entries:<br />        [strlen] = Array<br />        (<br />            [id]        => function.strlen<br />            [purpose]   => Get string length<br />            [prototype] => int strlen(string $string)<br />            [return]    => The length of the string on success,    and 0 if the string is empty.<br />            [versions]  => PHP 4, PHP 5<br />        )<br />        [HttpRequest::addHeaders] => Array<br />        (<br />            [id] => function.httprequest-addheaders<br />            [purpose] => Add headers<br />            [prototype] => bool HttpRequest::addHeaders(array $headers)<br />            [return] => Returns TRUE on success or FALSE on failure.<br />            [versions] => <br />        )</p></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre>  </pre></div></td></tr><tr id="section-11"><td class="docs"><div class="pilwrap"><a href="#section-11" class="pilcrow">&#182;</a></div><p>@todo Describe (implement?) other options like ->getParams(), ->getSeeAlsoEntries(), ->getChangelogEntries()</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">$json_arr</span><span class="p">[</span><span class="nv">$function_name_fixed</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    </pre></div></td></tr><tr id="section-12"><td class="docs"><div class="pilwrap"><a href="#section-12" class="pilcrow">&#182;</a></div><p>Example usage: php.net/$id works</p>
</td><td class="code"><div class="highlight"><pre>    <span class="s1">&#39;id&#39;</span>      <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$function</span><span class="o">-&gt;</span><span class="na">getManualId</span><span class="p">(),</span>
    
    <span class="s1">&#39;purpose&#39;</span>   <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$purpose</span><span class="p">,</span> 
    
    <span class="s1">&#39;prototype&#39;</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$prototype</span><span class="p">,</span>
    </pre></div></td></tr><tr id="section-13"><td class="docs"><div class="pilwrap"><a href="#section-13" class="pilcrow">&#182;</a></div><p>Return description. It contains text (including tables) so may be large and odd</p>
</td><td class="code"><div class="highlight"><pre>    <span class="s1">&#39;return&#39;</span>    <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$return</span><span class="p">,</span>
    </pre></div></td></tr><tr id="section-14"><td class="docs"><div class="pilwrap"><a href="#section-14" class="pilcrow">&#182;</a></div><p>@todo This appears empty for class::method's -- why?</p>
</td><td class="code"><div class="highlight"><pre>    <span class="s1">&#39;versions&#39;</span>  <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$function</span><span class="o">-&gt;</span><span class="na">getVersion</span><span class="p">(),</span>
  <span class="p">);</span>
<span class="p">}</span>

<span class="nv">$json_text</span> <span class="o">=</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$json_arr</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$json_text</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">echo</span> <span class="s1">&#39;Fatal Error: Could not create valid json.&#39;</span> <span class="o">.</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
  <span class="k">echo</span> <span class="s1">&#39;Information: json array has count of &#39;</span> <span class="o">.</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$json_arr</span><span class="p">)</span> <span class="o">.</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
  <span class="k">exit</span><span class="p">;</span>
<span class="p">}</span>
<span class="nv">$fn</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s1">&#39;LANG&#39;</span><span class="p">,</span> <span class="nv">$lang</span><span class="p">,</span> <span class="nx">FILENAME_JSON</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$json_text</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1000000</span><span class="p">)</span> <span class="p">{</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">file_put_contents</span><span class="p">(</span><span class="nv">$fn</span><span class="p">,</span> <span class="nv">$json_text</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s1">&#39;Fatal Error: Could not save JSON to &#39;</span> <span class="o">.</span> <span class="nv">$fn</span> <span class="o">.</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

</pre></div></td></tr></tbody></table><div id="generated">generated Sun Feb 17 2013 20:30:03 GMT-0500 (EST)  </div></div></body></html>